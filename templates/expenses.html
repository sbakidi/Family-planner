{% extends "layout.html" %}

{% block title %}Expenses{% endblock %}

{% block content %}
    <h2>Expenses</h2>

    {% if transactions %}
        <ul>
        {% for tx in transactions %}
            <li>
                {{ tx.date.strftime('%Y-%m-%d') if tx.date else '' }} -
                {{ tx.category.name if tx.category else 'Uncategorized' }} -
                ${{ '%.2f'|format(tx.amount) }} : {{ tx.description or '' }}
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No expenses recorded.</p>
    {% endif %}

    <hr>
    <h3>Log Expense</h3>
    <form method="POST" action="{{ url_for('add_expense') }}">
        <div>
            <label for="date">Date:</label>
            <input type="date" id="date" name="date" required>
        </div>
        <div>
            <label for="amount">Amount:</label>
            <input type="number" step="0.01" id="amount" name="amount" required>
        </div>
        <div>
            <label for="category_id">Category:</label>
            <select id="category_id" name="category_id">
                {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="description">Description (optional):</label>
            <input type="text" id="description" name="description">
        </div>
        <div>
            <input type="submit" value="Add Expense">
        </div>
    </form>
<h2>Shared Expenses</h2>

{% if expenses %}
<ul>
    {% for expense in expenses %}
    <li>
        {{ expense.description }} - ${{ '%.2f' % expense.amount }}
        {% if expense.child %}
            for {{ expense.child.name }}
        {% endif %}
        on {{ expense.expense_date.strftime('%Y-%m-%d') }}
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No expenses recorded.</p>
{% endif %}

<hr>
<h3>Add Expense</h3>
<form method="POST" action="{{ url_for('add_expense') }}">
    <label for="description">Description:</label>
    <input type="text" id="description" name="description" required>
    <label for="amount">Amount:</label>
    <input type="number" step="0.01" id="amount" name="amount" required>
    <label for="child_id">Child (optional):</label>
    <select id="child_id" name="child_id">
        <option value="">-- None --</option>
        {% for child in children %}
        <option value="{{ child.id }}">{{ child.name }}</option>
        {% endfor %}
    </select>
    <input type="submit" value="Add Expense">
</form>
{% endblock %}
